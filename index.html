<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>ESPE Header</title>
    <script type="module" src="src/components/espe-search-input.ts"></script>
    <script type="module" src="src/components/espe-header.ts"></script>
    <script type="module" src="src/components/footer-carousel.js"></script>
    <script type="module" src="src/components/espe-product-card.ts"></script>
    <script type="module" src="src/layout/espe-layout.js"></script>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        background-color: #414141;
      }

      .search-bar {
        max-width: 600px;
        margin: auto;
        margin-bottom: 2rem;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <espe-layout>
      <!-- Productos -->
      <!-- <section id="productos"> -->
        <espe-product-card></espe-product-card>
        <espe-product-card></espe-product-card>
        <espe-product-card></espe-product-card>
        <espe-product-card></espe-product-card>
        <espe-product-card></espe-product-card>
        <espe-product-card></espe-product-card>
        <espe-product-card></espe-product-card>
        <espe-product-card></espe-product-card>
      <!-- </section> -->
    </espe-layout>
    <script>
      const search = document.querySelector("espe-search-input");
      const cards = document.querySelectorAll("espe-product-card");

      // Set categories property on the header bar element
      const headerBar = document.getElementById("headerBar");
      if (headerBar) {
        headerBar.categories = [
          { label: 'Home', link: '/' },
          { label: 'CategorÃ­as', link: '/categorias' },
          { label: 'Materias', link: '/materias' },
          { label: 'Secciones', link: '/secciones' }
        ];
      }
      let valor = "";


      if (!valor) {
        cards.forEach((card) => (card.style.display = "block"));
      }

      search.addEventListener("sugerencia-seleccionada", (e) => {
        filtrar(e.detail.value);
      });

      search.addEventListener("input", (e) => {
        filtrar(e.target.value);
      });

      search.addEventListener("buscar-enter", (e) => {
        search.loading = true;
        filtrar(e.detail.value);
        setTimeout(() => {
          search.loading = false;
        }, 1000);
      });

      fetch('products.json')
      .then(res => res.json())
      .then(productos => {
      const contenedor = document.getElementById('productos');

      productos.forEach(p => {
        const card = document.createElement('espe-product-card');
        card.title = p.title;
        card.description = p.description;
        card.price = p.price;
        card.status = p.status;
        card.buttonTheme = p.buttonTheme;
        card.imageUrl = p.imageUrl;
        contenedor.appendChild(card);
      });
    });

    function filtrar(valor) {
      const tarjetas = document.querySelectorAll('espe-product-card');
      const valorLower = valor.toLowerCase();

      tarjetas.forEach((tarjeta) => {
        const titulo = tarjeta.title.toLowerCase();
        const descripcion = tarjeta.description?.toLowerCase() || '';
        
        const coincide = titulo.includes(valorLower) || descripcion.includes(valorLower);
        tarjeta.style.display = coincide ? 'block' : 'none';
      });
    }
    </script>
  </body>
</html>
